# Another Me - ç³»ç»Ÿé‡æ„è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: 2.0.0  
**æ—¥æœŸ**: 2025-11-07  
**çŠ¶æ€**: é‡æ„å»ºè®®

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### å½“å‰é—®é¢˜
1. **éœ€æ±‚ä¸æ¸…æ™°**: RAG å’Œ MEM åŠŸèƒ½ç•Œé™æ¨¡ç³Šï¼Œç¼ºå°‘æ¸…æ™°çš„ç”¨æˆ·åœºæ™¯
2. **æ¶æ„æ··ä¹±**: Service å±‚è¿‡è–„ï¼Œä¸šåŠ¡é€»è¾‘åˆ†æ•£ï¼Œæ•°æ®æ¨¡å‹ä¸ç»Ÿä¸€
3. **å®ç°ä¸å®Œæ•´**: å¤šå¤„ TODOï¼ŒCRUD åŠŸèƒ½ç¼ºå¤±ï¼Œå‰ç«¯é¡µé¢æœªå®Œæˆ

### é‡æ„ç›®æ ‡
- âœ… æ˜ç¡® RAGï¼ˆçŸ¥è¯†é—®ç­”ï¼‰å’Œ MEMï¼ˆé£æ ¼æ¨¡ä»¿ï¼‰çš„è¾¹ç•Œ
- âœ… å»ºç«‹æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ˆAPI â†’ Service â†’ Engine â†’ Repository â†’ Storageï¼‰
- âœ… ç»Ÿä¸€æ•°æ®æ¨¡å‹å’Œæ¥å£è§„èŒƒ
- âœ… å®Œå–„æ ¸å¿ƒåŠŸèƒ½çš„å®Œæ•´å®ç°

---

## 1. æ ¸å¿ƒæ¦‚å¿µé‡æ–°å®šä¹‰

### 1.1 åŠŸèƒ½å®šä½

#### 1.1.1 ä¸¤å¤§æ ¸å¿ƒèƒ½åŠ›

**ğŸ¤– æ¨¡ä»¿æˆ‘ (Mimic Me)** - é£æ ¼å­¦ä¹ ä¸ç”Ÿæˆ
- ç›®æ ‡: å­¦ä¹ ç”¨æˆ·çš„è¯´è¯æ–¹å¼ã€æ€ç»´ä¹ æƒ¯ã€è¡¨è¾¾é£æ ¼
- æ•°æ®æº: èŠå¤©è®°å½•ã€æ—¥è®°ã€ç¤¾äº¤åª’ä½“å‘è¨€
- ç‰¹ç‚¹: ä¸»è§‚é£æ ¼å¤åˆ¶ + ä¸ªæ€§åŒ–ç”Ÿæˆ

**ğŸ” åˆ†ææˆ‘ (Analyze Me)** - æ·±åº¦æ´å¯Ÿä¸æ€»ç»“
- ç›®æ ‡: åˆ†æç”¨æˆ·çš„è¡Œä¸ºæ¨¡å¼ã€å…´è¶£æ¼”åŒ–ã€çŸ¥è¯†ç»“æ„
- æ•°æ®æº: å…¨é‡å†å²æ•°æ® + å›¾è°±å…³ç³»
- ç‰¹ç‚¹: å®¢è§‚è§„å¾‹æå– + è¶‹åŠ¿é¢„æµ‹

#### 1.1.2 ä¸¤å¤§åº”ç”¨åœºæ™¯

**ğŸ’¼ å·¥ä½œåœºæ™¯ (Work)** - æ•ˆç‡å·¥å…·
```
åŠŸèƒ½åˆ—è¡¨:
- ğŸ“Š å‘¨æŠ¥ç”Ÿæˆ: è‡ªåŠ¨æ€»ç»“æœ¬å‘¨å·¥ä½œå†…å®¹å’Œæˆæœ
- ğŸ“ æ—¥æŠ¥ç”Ÿæˆ: æå–å½“æ—¥å…³é”®ä»»åŠ¡å’Œè¿›å±•
- âœ… å¾…åŠæ•´ç†: æ™ºèƒ½å½’ç±»å’Œä¼˜å…ˆçº§æ’åº
- ğŸ¯ é¡¹ç›®æ€»ç»“: åˆ†æé¡¹ç›®è¿‡ç¨‹å’Œç»éªŒæ•™è®­
- ğŸ“ˆ å·¥ä½œåˆ†æ: æ—¶é—´åˆ†é…ã€æ•ˆç‡è¶‹åŠ¿ã€æŠ€èƒ½æˆé•¿
- ğŸ’¡ å†³ç­–å»ºè®®: åŸºäºå†å²æ•°æ®çš„å†³ç­–æ”¯æŒ

æ•°æ®æ¥æº:
- å·¥ä½œæ—¥å¿—ã€ä¼šè®®è®°å½•ã€é‚®ä»¶ã€æ–‡æ¡£
- é¡¹ç›®ç®¡ç†å·¥å…·æ•°æ®ã€ä»£ç æäº¤è®°å½•
```

**ğŸ¡ ç”Ÿæ´»åœºæ™¯ (Life)** - æƒ…æ„Ÿé™ªä¼´
```
åŠŸèƒ½åˆ—è¡¨:
- ğŸ’¬ èŠå¤©é™ªä¼´: æ¨¡ä»¿ç”¨æˆ·é£æ ¼è¿›è¡Œå¯¹è¯
- ğŸ˜Š æƒ…ç»ªå®‰æ…°: è¯†åˆ«æƒ…ç»ªå¹¶æä¾›å®‰æ…°
- ğŸ­ è§’è‰²æ‰®æ¼”: "å¦‚æœæ˜¯æˆ‘ï¼Œæˆ‘ä¼šæ€ä¹ˆè¯´ï¼Ÿ"
- ğŸ“– è®°å¿†å›é¡¾: "å»å¹´ä»Šæ—¥æˆ‘åœ¨åšä»€ä¹ˆï¼Ÿ"
- ğŸ¨ åˆ›æ„åŠ©æ‰‹: æœ‹å‹åœˆæ–‡æ¡ˆã€ç¥ç¦è¯­ç”Ÿæˆ
- ğŸ’­ è‡ªæˆ‘å¯¹è¯: ä¸è¿‡å»çš„è‡ªå·±å¯¹è¯

æ•°æ®æ¥æº:
- ç§äººæ—¥è®°ã€èŠå¤©è®°å½•ã€ç…§ç‰‡ã€ç¤¾äº¤åª’ä½“
```

### 1.2 ç”¨æˆ·äº¤äº’è®¾è®¡

#### 1.2.1 ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Another Me - ä¸–ç•Œä¸Šå¦ä¸€ä¸ªæˆ‘                    [@ç”¨æˆ·å]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å·¥ä½œ] [ç”Ÿæ´»] [æ•°æ®ç®¡ç†] [è®¾ç½®]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å½“å‰æ¨¡å¼: ğŸ’¼ å·¥ä½œ                                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ ğŸ¤– æ¨¡ä»¿æˆ‘    â”‚  â”‚ ğŸ” åˆ†ææˆ‘    â”‚                         â”‚
â”‚  â”‚             â”‚  â”‚             â”‚                         â”‚
â”‚  â”‚ â€¢ å‘¨æŠ¥ç”Ÿæˆ  â”‚  â”‚ â€¢ å·¥ä½œåˆ†æ  â”‚                         â”‚
â”‚  â”‚ â€¢ æ—¥æŠ¥ç”Ÿæˆ  â”‚  â”‚ â€¢ æ—¶é—´åˆ†å¸ƒ  â”‚                         â”‚
â”‚  â”‚ â€¢ å¾…åŠæ•´ç†  â”‚  â”‚ â€¢ æŠ€èƒ½æˆé•¿  â”‚                         â”‚
â”‚  â”‚ â€¢ é‚®ä»¶å›å¤  â”‚  â”‚ â€¢ é¡¹ç›®æ´å¯Ÿ  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¬ å¿«é€Ÿå¯¹è¯æ¡†                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤...                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2.2 å·¥ä½œæ¨¡å¼äº¤äº’æµç¨‹

**å‘¨æŠ¥ç”Ÿæˆåœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ:
1. åˆ‡æ¢åˆ° [å·¥ä½œ] Tab
2. ç‚¹å‡» "ğŸ¤– æ¨¡ä»¿æˆ‘" â†’ "å‘¨æŠ¥ç”Ÿæˆ"

ç³»ç»Ÿæµç¨‹:
Step 1: æ•°æ®æ”¶é›†
  â†’ Faiss æ£€ç´¢æœ¬å‘¨å·¥ä½œè®°å½•ï¼ˆæ—¶é—´è¿‡æ»¤ï¼šlast 7 daysï¼‰
  â†’ Falkor åˆ†æé¡¹ç›®å…³ç³»å’Œä»»åŠ¡çŠ¶æ€
  
Step 2: å†…å®¹ç”Ÿæˆ
  â†’ åˆ†ææˆ‘: æå–å…³é”®ä»»åŠ¡ã€æˆæœã€æ•°æ®
  â†’ æ¨¡ä»¿æˆ‘: ç”¨ç”¨æˆ·çš„è¯­è¨€é£æ ¼æ’°å†™å‘¨æŠ¥
  
Step 3: äº¤äº’ä¼˜åŒ–
  â†’ å±•ç¤ºç”Ÿæˆçš„å‘¨æŠ¥ï¼ˆå¯ç¼–è¾‘ï¼‰
  â†’ æä¾›è°ƒæ•´é€‰é¡¹ï¼š"æ›´æ­£å¼" "æ›´è¯¦ç»†" "åŠ å…¥æ•°æ®"
  â†’ ä¸€é”®å¤åˆ¶æˆ–å¯¼å‡º

è¾“å‡ºç¤ºä¾‹:
---
æœ¬å‘¨å·¥ä½œæ€»ç»“ (2025.11.01-11.07)

ä¸»è¦æˆæœ:
1. å®Œæˆäº† Another Me åŒå­˜å‚¨æ¶æ„è®¾è®¡ âœ…
2. ä¼˜åŒ–äº†æ··åˆæ£€ç´¢ç®—æ³•ï¼Œå‡†ç¡®ç‡æå‡ 20% ğŸ“ˆ
3. é‡æ„äº† Repository å±‚ï¼Œä»£ç æ›´æ¸…æ™°äº† ğŸ’ª

é‡åˆ°çš„æŒ‘æˆ˜:
- Faiss ç´¢å¼•æ„å»ºæ—¶å†…å­˜å ç”¨è¾ƒé«˜ï¼Œéœ€è¦ä¼˜åŒ–

ä¸‹å‘¨è®¡åˆ’:
- å¼€å§‹ Phase 1 å®æ–½ï¼Œå…ˆé›†æˆ Faiss
---
```

**æ—¥æŠ¥ç”Ÿæˆåœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ: æ¯å¤©ä¸‹ç­å‰ç‚¹å‡» "æ—¥æŠ¥ç”Ÿæˆ"

ç³»ç»Ÿæµç¨‹:
1. Faiss æ£€ç´¢ä»Šæ—¥æ‰€æœ‰å·¥ä½œè®°å½•
2. è¯†åˆ«å…³é”®ä»»åŠ¡å’Œæ—¶é—´åˆ†é…
3. ç”¨ç”¨æˆ·é£æ ¼ç”Ÿæˆç®€æ´æ—¥æŠ¥

è¾“å‡º:
---
ä»Šæ—¥å®Œæˆ:
- è®¾è®¡æ–‡æ¡£ä¼˜åŒ– (3h)
- Code Review (1.5h)
- å›¢é˜Ÿä¼šè®® (1h)

æ˜æ—¥è®¡åˆ’:
- å¼€å§‹ç¼–ç  Faiss é›†æˆ
---
```

**å¾…åŠæ•´ç†åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ: è¾“å…¥ "å¸®æˆ‘æ•´ç†å¾…åŠäº‹é¡¹"

ç³»ç»Ÿæµç¨‹:
1. åˆ†ææˆ‘: 
   â†’ Falkor å›¾è°±åˆ†ææœªå®Œæˆä»»åŠ¡
   â†’ è¯†åˆ«ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»
   â†’ è¯„ä¼°ä¼˜å…ˆçº§ï¼ˆç´§æ€¥åº¦ + é‡è¦æ€§ï¼‰
   
2. æ¨¡ä»¿æˆ‘:
   â†’ ç”¨ç”¨æˆ·ä¹ æƒ¯çš„åˆ†ç±»æ–¹å¼ç»„ç»‡
   â†’ æ·»åŠ ç”¨æˆ·é£æ ¼çš„å¤‡æ³¨

è¾“å‡º:
---
ğŸ“Œ é«˜ä¼˜å…ˆçº§:
1. [ç´§æ€¥] ä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug (ä»Šå¤©)
2. [é‡è¦] å®Œæˆæ¶æ„è®¾è®¡æ–‡æ¡£ (æ˜å¤©)

ğŸ“‹ ä¸­ä¼˜å…ˆçº§:
3. Code Review: 3ä¸ªPRå¾…å®¡æ ¸
4. å­¦ä¹  Faiss å®˜æ–¹æ–‡æ¡£

ğŸ’¡ ä½ä¼˜å…ˆçº§:
5. ä¼˜åŒ–æ—¥å¿—ç³»ç»Ÿ
---
```

#### 1.2.3 ç”Ÿæ´»æ¨¡å¼äº¤äº’æµç¨‹

**èŠå¤©é™ªä¼´åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ: åˆ‡æ¢åˆ° [ç”Ÿæ´»] â†’ å¼€å§‹èŠå¤©

ç³»ç»Ÿç‰¹ç‚¹:
- æ¨¡ä»¿æˆ‘: ç”¨ç”¨æˆ·çš„è¯­æ°”å’Œè¡¨è¾¾ä¹ æƒ¯å›å¤
- åˆ†ææˆ‘: è¯†åˆ«æƒ…ç»ªï¼Œæä¾›åˆé€‚çš„å›åº”

å¯¹è¯ç¤ºä¾‹:
ç”¨æˆ·: "ä»Šå¤©å¥½ç´¯å•Šï¼Œä¸æƒ³å¹²æ´»äº†"
ç³»ç»Ÿ: "å“ˆå“ˆï¼Œæˆ‘æ‡‚ï¼è¦ä¸å…ˆä¼‘æ¯ä¼šå„¿ï¼Ÿä¸Šæ¬¡ä½ ä¹Ÿè¿™ä¹ˆè¯´ï¼Œ
      åæ¥å»æ•£äº†ä¸ªæ­¥å°±å¥½å¤šäº†ã€‚è¦ä¸è¦æˆ‘ç»™ä½ æ”¾é¦–æ­Œï¼Ÿ"
      (ç»“åˆå†å²: Falkor æŸ¥åˆ°ç”¨æˆ·ç–²æƒ«æ—¶å–œæ¬¢æ•£æ­¥)
```

**æƒ…ç»ªå®‰æ…°åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ: å€¾è¯‰çƒ¦æ¼

ç³»ç»Ÿæµç¨‹:
1. åˆ†ææˆ‘: è¯†åˆ«æƒ…ç»ªï¼ˆéš¾è¿‡/ç„¦è™‘/å‹åŠ›ï¼‰
2. Falkor æŸ¥è¯¢: è¿‡å»ç±»ä¼¼æƒ…å†µå¦‚ä½•åº¦è¿‡çš„
3. æ¨¡ä»¿æˆ‘: ç”¨ç”¨æˆ·è‡ªå·±ä¼šå¯¹è‡ªå·±è¯´çš„è¯æ¥å®‰æ…°

å¯¹è¯:
ç”¨æˆ·: "é¡¹ç›®åˆå»¶æœŸäº†ï¼Œæ„Ÿè§‰è‡ªå·±å¥½å¤±è´¥"
ç³»ç»Ÿ: "åˆ«è¿™ä¹ˆè¯´ï¼è®°å¾—ä¸Šæ¬¡é‚£ä¸ªé¡¹ç›®å—ï¼Ÿå½“æ—¶ä¹Ÿå»¶æœŸäº†ï¼Œ
      ä½†æœ€ååšå‡ºæ¥æ•ˆæœè¶…å¥½ï¼Œå®¢æˆ·å¾ˆæ»¡æ„ã€‚è¿™æ¬¡ä¹Ÿä¼šçš„ï¼
      è€Œä¸”ä½ å·²ç»å¾ˆåŠªåŠ›äº†ï¼Œæœ‰äº›äº‹æƒ…ä¸æ˜¯æˆ‘ä»¬èƒ½æ§åˆ¶çš„ã€‚"
```

**è®°å¿†å›é¡¾åœºæ™¯**:
```
ç”¨æˆ·æ“ä½œ: "å»å¹´ä»Šå¤©æˆ‘åœ¨åšä»€ä¹ˆï¼Ÿ"

ç³»ç»Ÿæµç¨‹:
1. Faiss + Falkor è”åˆæŸ¥è¯¢: æ—¶é—´è¿‡æ»¤ = å»å¹´ä»Šå¤©
2. æ‰¾åˆ°å½“å¤©çš„è®°å½•ï¼ˆæ—¥è®°ã€ç…§ç‰‡ã€æ´»åŠ¨ï¼‰
3. æ¸©é¦¨å‘ˆç°

è¾“å‡º:
---
ğŸ“… 2024å¹´11æœˆ7æ—¥

é‚£å¤©ä½ :
- å’Œæœ‹å‹å»çˆ¬å±±ï¼Œè¿˜æ‹äº†å¾ˆå¤šç…§ç‰‡ ğŸ”ï¸
- æ™šä¸Šå†™æ—¥è®°è¯´ï¼š"ä»Šå¤©çš„å¤•é˜³çœŸç¾"
- åœ¨æ€è€ƒè¦ä¸è¦æ¢å·¥ä½œ

ä¸€å¹´è¿‡å»äº†ï¼Œç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ
---
```

#### 1.2.4 æ¨¡å¼åˆ‡æ¢é€»è¾‘

```python
class UserContext:
    mode: str = "work" | "life"  # å½“å‰æ¨¡å¼
    capability: str = "mimic" | "analyze"  # å½“å‰èƒ½åŠ›
    
# è‡ªåŠ¨åˆ‡æ¢è§„åˆ™
def auto_switch_mode(user_input: str) -> str:
    """
    æ ¹æ®è¾“å…¥è‡ªåŠ¨åˆ¤æ–­æ¨¡å¼
    
    å·¥ä½œå…³é”®è¯: å‘¨æŠ¥ã€æ—¥æŠ¥ã€é¡¹ç›®ã€ä»»åŠ¡ã€ä¼šè®®ã€ä»£ç 
    ç”Ÿæ´»å…³é”®è¯: èŠå¤©ã€å¼€å¿ƒã€éš¾è¿‡ã€æœ‹å‹ã€å‘¨æœ«ã€ç”µå½±
    """
    work_keywords = ["å‘¨æŠ¥", "æ—¥æŠ¥", "é¡¹ç›®", "ä»»åŠ¡", "å·¥ä½œ"]
    life_keywords = ["èŠå¤©", "å¼€å¿ƒ", "æœ‹å‹", "å¿ƒæƒ…"]
    
    if any(k in user_input for k in work_keywords):
        return "work"
    elif any(k in user_input for k in life_keywords):
        return "life"
    else:
        return current_mode  # ä¿æŒå½“å‰æ¨¡å¼
```

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ ¸å¿ƒæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢å±‚                                â”‚
â”‚  [å·¥ä½œæ¨¡å¼]           [ç”Ÿæ´»æ¨¡å¼]                        â”‚
â”‚  æ¨¡ä»¿æˆ‘ | åˆ†ææˆ‘     æ¨¡ä»¿æˆ‘ | åˆ†ææˆ‘                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Service å±‚ï¼ˆä¸šåŠ¡ç¼–æ’ï¼‰                      â”‚
â”‚  WorkService (å·¥ä½œåœºæ™¯)     LifeService (ç”Ÿæ´»åœºæ™¯)          â”‚
â”‚    â”‚                             â”‚                           â”‚
â”‚    â”œâ”€ å‘¨æŠ¥ç”Ÿæˆ                    â”œâ”€ èŠå¤©é™ªä¼´                â”‚
â”‚    â”œâ”€ æ—¥æŠ¥ç”Ÿæˆ                    â”œâ”€ æƒ…ç»ªå®‰æ…°                â”‚
â”‚    â”œâ”€ å¾…åŠæ•´ç†                    â”œâ”€ è®°å¿†å›é¡¾                â”‚
â”‚    â””â”€ å·¥ä½œåˆ†æ                    â””â”€ é£æ ¼æ¨¡ä»¿                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Engine å±‚ (AME)                             â”‚
â”‚  MimicEngine (æ¨¡ä»¿)          AnalyzeEngine (åˆ†æ)             â”‚
â”‚    â”‚                             â”‚                           â”‚
â”‚    â”œâ”€ é£æ ¼å­¦ä¹                     â”œâ”€ æ•°æ®èšåˆ                â”‚
â”‚    â”œâ”€ ä¸Šä¸‹æ–‡ç”Ÿæˆ                  â”œâ”€ æ¨¡å¼è¯†åˆ«                â”‚
â”‚    â””â”€ æµå¼è¾“å‡º                    â””â”€ è¶‹åŠ¿åˆ†æ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Repository å±‚ (æ•°æ®è®¿é—®)                       â”‚
â”‚  HybridRepository (æ··åˆæ£€ç´¢)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Storage å±‚ (åŒå­˜å‚¨)                          â”‚
â”‚  Faiss (çŸ­æœŸè®°å¿†)        Falkor (é•¿æœŸçŸ¥è¯†å›¾è°±)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Service å±‚è®¾è®¡

#### WorkService - å·¥ä½œåœºæ™¯æœåŠ¡

```python
class WorkService:
    """å·¥ä½œåœºæ™¯ä¸šåŠ¡æœåŠ¡"""
    
    def __init__(self, mimic_engine, analyze_engine, repo):
        self.mimic = mimic_engine
        self.analyze = analyze_engine
        self.repo = repo
    
    async def generate_weekly_report(self, user_id: str) -> str:
        """ç”Ÿæˆå‘¨æŠ¥"""
        # 1. åˆ†ææˆ‘: æ”¶é›†æœ¬å‘¨æ•°æ®
        this_week_data = await self.analyze.collect_time_range(
            user_id, 
            start=datetime.now() - timedelta(days=7),
            category="work"
        )
        
        # 2. åˆ†ææˆ‘: æå–å…³é”®ä¿¡æ¯
        insights = await self.analyze.extract_insights(this_week_data, [
            "key_tasks",      # å…³é”®ä»»åŠ¡
            "achievements",   # æˆæœ
            "challenges",     # æŒ‘æˆ˜
            "time_stats"      # æ—¶é—´ç»Ÿè®¡
        ])
        
        # 3. æ¨¡ä»¿æˆ‘: ç”¨ç”¨æˆ·é£æ ¼ç”Ÿæˆå‘¨æŠ¥
        report = await self.mimic.generate_styled_text(
            template="weekly_report",
            data=insights,
            tone="professional"  # å·¥ä½œåœºæ™¯ä½¿ç”¨ä¸“ä¸šè¯­æ°”
        )
        
        return report
    
    async def organize_todos(self, user_id: str) -> Dict:
        """æ•´ç†å¾…åŠäº‹é¡¹"""
        # 1. åˆ†ææˆ‘: Falkor å›¾è°±åˆ†æä»»åŠ¡å…³ç³»
        tasks = await self.analyze.analyze_task_graph(user_id)
        
        # 2. åˆ†ææˆ‘: è¯„ä¼°ä¼˜å…ˆçº§
        prioritized = await self.analyze.prioritize_tasks(
            tasks,
            factors=["urgency", "importance", "dependencies"]
        )
        
        # 3. æ¨¡ä»¿æˆ‘: ç”¨ç”¨æˆ·ä¹ æƒ¯çš„åˆ†ç±»æ–¹å¼ç»„ç»‡
        organized = await self.mimic.organize_by_user_habit(
            prioritized,
            user_id
        )
        
        return organized

#### LifeService - ç”Ÿæ´»åœºæ™¯æœåŠ¡

```python
class LifeService:
    """ç”Ÿæ´»åœºæ™¯ä¸šåŠ¡æœåŠ¡"""
    
    async def chat_companion(self, user_id: str, message: str) -> AsyncIterator[str]:
        """èŠå¤©é™ªä¼´"""
        # 1. åˆ†ææˆ‘: è¯†åˆ«æƒ…ç»ª
        emotion = await self.analyze.detect_emotion(message)
        
        # 2. åˆ†ææˆ‘: Falkor æŸ¥è¯¢ç›¸å…³è®°å¿†
        related_memories = await self.repo.graph_search(
            query=message,
            context={"emotion": emotion, "category": "life"}
        )
        
        # 3. æ¨¡ä»¿æˆ‘: ç”Ÿæˆå›å¤ï¼ˆæµå¼ï¼‰
        async for chunk in self.mimic.generate_response_stream(
            message=message,
            context=related_memories,
            tone="casual",  # ç”Ÿæ´»åœºæ™¯ä½¿ç”¨è½»æ¾è¯­æ°”
            emotion_aware=True
        ):
            yield chunk
    
    async def memory_recall(self, user_id: str, query: str) -> Dict:
        """è®°å¿†å›é¡¾"""
        # 1. åˆ†ææˆ‘: è§£ææ—¶é—´æ„å›¾
        time_range = await self.analyze.parse_time_query(query)
        
        # 2. Faiss + Falkor æ··åˆæ£€ç´¢
        memories = await self.repo.hybrid_search(
            query=query,
            time_filter=time_range,
            category="life"
        )
        
        # 3. æ¨¡ä»¿æˆ‘: æ¸©é¦¨å‘ˆç°
        presentation = await self.mimic.present_memories(
            memories,
            style="warm_narrative"  # æ¸©é¦¨çš„å™è¿°æ–¹å¼
        )
        
        return presentation
```

### 2.1 åŒå­˜å‚¨æ¶æ„ (Faiss + Falkor)

**æ ¸å¿ƒè®¾è®¡ç†å¿µ**: çŸ­æœŸè®°å¿† + é•¿æœŸçŸ¥è¯†å›¾è°±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend (React + TypeScript)                   â”‚  ç”¨æˆ·ç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              API Layer (FastAPI Routes)                      â”‚  HTTP æ¥å£
â”‚  /api/v1/rag/*    /api/v1/mem/*    /api/v1/graph/*         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Service Layer (Business Logic)                  â”‚  ä¸šåŠ¡ç¼–æ’
â”‚  RAGService       MEMService      GraphService              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Engine Layer (AME)                             â”‚  æŠ€æœ¯å®ç°
â”‚  KnowledgeBase    MimicEngine    GraphAnalyzer             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Repository Layer (Data Access)                  â”‚  æ•°æ®è®¿é—®
â”‚  VectorRepository    GraphRepository    HybridRepository    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Storage Layer (åŒå­˜å‚¨ç³»ç»Ÿ)                      â”‚  å­˜å‚¨å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Faiss Vector DB â”‚  â”‚  Falkor Graph DB â”‚  â”‚ SQLite   â”‚ â”‚
â”‚  â”‚  (è¿‘æœŸè®°å¿†/å¿«é€Ÿ) â”‚  â”‚  (é•¿æœŸçŸ¥è¯†/å…³ç³») â”‚  â”‚ (å…ƒæ•°æ®) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åŒå­˜å‚¨åˆ†å·¥ç­–ç•¥

**Faiss å‘é‡æ•°æ®åº“** - çŸ­æœŸè®°å¿†ä¸å¿«é€Ÿå“åº”
- âœ… è¿‘æœŸå¯¹è¯è®°å½•ï¼ˆæœ€è¿‘ 7-30 å¤©ï¼‰
- âœ… å®æ—¶å‘é‡æ£€ç´¢ï¼ˆæ¯«ç§’çº§å“åº”ï¼‰
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…
- âœ… é£æ ¼æ¨¡ä»¿çš„å³æ—¶ä¸Šä¸‹æ–‡
- ğŸ¯ **åœºæ™¯**: "åˆšæ‰æˆ‘ä»¬èŠäº†ä»€ä¹ˆï¼Ÿ" "æœ€è¿‘æˆ‘åœ¨å…³æ³¨ä»€ä¹ˆï¼Ÿ"

**Falkor å›¾è°±æ•°æ®åº“** - é•¿æœŸçŸ¥è¯†ä¸å…³ç³»åˆ†æ
- âœ… å®ä½“å…³ç³»å»ºæ¨¡ï¼ˆäººç‰©ã€äº‹ä»¶ã€æ¦‚å¿µï¼‰
- âœ… æ—¶é—´åºåˆ—åˆ†æï¼ˆè®°å¿†æ¼”åŒ–ï¼‰
- âœ… çŸ¥è¯†æ¨ç†ï¼ˆå¤šè·³æŸ¥è¯¢ï¼‰
- âœ… å…´è¶£å›¾è°±å’Œç¤¾äº¤ç½‘ç»œ
- ğŸ¯ **åœºæ™¯**: "æˆ‘å’Œå¼ ä¸‰çš„å…³ç³»å˜åŒ–ï¼Ÿ" "æˆ‘çš„æŠ€æœ¯æ ˆæ¼”è¿›è·¯å¾„ï¼Ÿ"

**ååŒå·¥ä½œæ¨¡å¼**:
```
ç”¨æˆ·æé—®
    â†“
1. Faiss å¿«é€Ÿå¬å›ï¼ˆTop 20 è¿‘æœŸç›¸å…³ï¼‰
2. Falkor å›¾è°±æ¨ç†ï¼ˆå…³ç³»é“¾è·¯ã€å†å²èƒŒæ™¯ï¼‰
3. èåˆç»“æœï¼ˆFaiss ç›¸å…³æ€§ + Falkor å…³è”æ€§ï¼‰
    â†“
ç”Ÿæˆç­”æ¡ˆï¼ˆç»“åˆè¿‘æœŸè®°å¿† + é•¿æœŸçŸ¥è¯†ï¼‰
```

### 2.3 æ•°æ®æµç¤ºä¾‹

**çŸ¥è¯†é—®ç­”æµç¨‹**:
```
ç”¨æˆ·æé—® â†’ API /rag/ask 
  â†’ RAGService.ask_question()
    â†’ KnowledgeBase.search() (æ£€ç´¢)
    â†’ RAGGenerator.generate() (ç”Ÿæˆç­”æ¡ˆ)
  â†’ è¿”å›ç­”æ¡ˆ + å¼•ç”¨æ¥æº
```

**å¯¹è¯ç”Ÿæˆæµç¨‹**:
```
ç”¨æˆ·æ¶ˆæ¯ â†’ API /mem/chat (SSE)
  â†’ MEMService.chat_stream()
    â†’ MimicEngine.generate_response_stream()
      â†’ æ£€ç´¢ç›¸ä¼¼å¯¹è¯
      â†’ æ„å»ºé£æ ¼ Prompt
      â†’ LLM æµå¼ç”Ÿæˆ
  â†’ æµå¼è¿”å›ç»™å‰ç«¯
```

---

## 3. æ ¸å¿ƒè®¾è®¡

### 3.1 ç»Ÿä¸€æ•°æ®æ¨¡å‹ï¼ˆæ‰©å±•å›¾è°±æ”¯æŒï¼‰

```python
# åŸºç¡€æ–‡æ¡£æ¨¡å‹ï¼ˆæ”¯æŒåŒå­˜å‚¨ï¼‰
class Document(BaseModel):
    id: str                      # UUID
    content: str                 # æ–‡æœ¬å†…å®¹
    doc_type: DocumentType       # æ–‡æ¡£ç±»å‹æšä¸¾
    source: str                  # æ¥æº
    timestamp: datetime          # æ–‡æ¡£æ—¶é—´
    metadata: Dict[str, Any]     # æ‰©å±•å…ƒæ•°æ®
    
    # å‘é‡å­˜å‚¨ç›¸å…³ï¼ˆFaissï¼‰
    embedding: Optional[List[float]] = None
    faiss_index: Optional[int] = None  # Faiss ç´¢å¼•ä½ç½®
    
    # å›¾è°±å­˜å‚¨ç›¸å…³ï¼ˆFalkorï¼‰
    graph_node_id: Optional[str] = None  # å›¾è°±èŠ‚ç‚¹ ID
    entities: List[str] = []             # æå–çš„å®ä½“
    relations: List[Dict] = []           # å…³ç³»ä¸‰å…ƒç»„
    
    created_at: datetime
    updated_at: datetime

# æ–‡æ¡£ç±»å‹
class DocumentType(Enum):
    RAG_KNOWLEDGE = "rag_knowledge"
    MEM_CONVERSATION = "mem_conversation"
    MEM_DIARY = "mem_diary"

# çŸ¥è¯†æ–‡æ¡£ï¼ˆç»§æ‰¿ Documentï¼‰
class Knowledge(Document):
    doc_type = DocumentType.RAG_KNOWLEDGE
    tags: List[str]              # æ ‡ç­¾
    file_path: Optional[str]     # åŸå§‹æ–‡ä»¶è·¯å¾„
    chunk_index: int             # åˆ†å—ç´¢å¼•

# è®°å¿†æ–‡æ¡£ï¼ˆç»§æ‰¿ Documentï¼‰
class Memory(Document):
    doc_type = DocumentType.MEM_CONVERSATION
    emotion: Optional[str]       # æƒ…ç»ª
    importance: float            # é‡è¦æ€§è¯„åˆ†
```

### 3.2 Repository æ¨¡å¼

```python
# æŠ½è±¡åŸºç±»
class BaseRepository(ABC):
    @abstractmethod
    async def create(self, doc: Document) -> Document:
        """åˆ›å»ºæ–‡æ¡£"""
    
    @abstractmethod
    async def get(self, doc_id: str) -> Optional[Document]:
        """è·å–å•ä¸ªæ–‡æ¡£"""
    
    @abstractmethod
    async def list(
        self, 
        filters: Dict, 
        page: int = 1, 
        page_size: int = 20
    ) -> PaginatedResponse[Document]:
        """åˆ†é¡µåˆ—è¡¨"""
    
    @abstractmethod
    async def update(self, doc_id: str, updates: Dict) -> Document:
        """æ›´æ–°æ–‡æ¡£"""
    
    @abstractmethod
    async def delete(self, doc_id: str) -> bool:
        """åˆ é™¤æ–‡æ¡£"""
    
    @abstractmethod
    async def search(
        self, 
        query: str, 
        filters: Dict, 
        top_k: int = 5
    ) -> List[SearchResult]:
        """å‘é‡æ£€ç´¢"""

# å®ç°ç±»
class VectorRepository(BaseRepository):
    def __init__(self, vector_store, metadata_db):
        self.vector_store = vector_store
        self.metadata_db = metadata_db  # SQLite å­˜å‚¨å…ƒæ•°æ®
```

### 3.3 Service å±‚èŒè´£

**RAGService**:
```python
class RAGService:
    # çŸ¥è¯† CRUD
    async def create_knowledge(file, tags, metadata) -> Knowledge
    async def get_knowledge(id) -> Knowledge
    async def list_knowledge(filters, pagination) -> PaginatedList
    async def update_knowledge(id, updates) -> Knowledge
    async def delete_knowledge(id) -> bool
    
    # çŸ¥è¯†æ£€ç´¢
    async def search_knowledge(query, filters, top_k) -> SearchResult
    
    # æ™ºèƒ½é—®ç­”
    async def ask_question(question, context) -> QAResponse
    async def ask_question_stream(question, context) -> AsyncIterator[str]
```

**MEMService**:
```python
class MEMService:
    # è®°å¿† CRUD
    async def create_memory(content, mem_type, metadata) -> Memory
    async def get_memory(id) -> Memory
    async def list_memories(filters, pagination) -> PaginatedList
    async def delete_memory(id) -> bool
    
    # å¯¹è¯ç”Ÿæˆ
    async def chat(message, params) -> ChatResponse
    async def chat_stream(message, params) -> AsyncIterator[str]
    
    # é£æ ¼åˆ†æ
    async def analyze_style() -> StyleProfile
    
    # æ‰¹é‡å­¦ä¹ 
    async def learn_from_file(file) -> LearnResult
```

### 3.4 API æ¥å£è§„èŒƒ

**ç»Ÿä¸€å“åº”æ ¼å¼**:
```python
# æˆåŠŸå“åº”
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2025-11-07T10:00:00Z"
}

# é”™è¯¯å“åº”
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å‚æ•°éªŒè¯å¤±è´¥",
    "details": { ... }
  },
  "timestamp": "2025-11-07T10:00:00Z"
}

# åˆ†é¡µå“åº”
{
  "success": true,
  "data": [ ... ],
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 100,
    "total_pages": 5
  }
}
```

**æ ¸å¿ƒ API ç«¯ç‚¹**:
```
# RAG
POST   /api/v1/rag/knowledge          # ä¸Šä¼ çŸ¥è¯†
GET    /api/v1/rag/knowledge          # åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
GET    /api/v1/rag/knowledge/{id}     # è¯¦æƒ…
PUT    /api/v1/rag/knowledge/{id}     # æ›´æ–°
DELETE /api/v1/rag/knowledge/{id}     # åˆ é™¤
POST   /api/v1/rag/search             # æ£€ç´¢
POST   /api/v1/rag/ask                # é—®ç­”ï¼ˆæ”¯æŒæµå¼ï¼‰

# MEM
POST   /api/v1/mem/memory             # åˆ›å»ºè®°å¿†
GET    /api/v1/mem/memory             # åˆ—è¡¨
GET    /api/v1/mem/memory/{id}        # è¯¦æƒ…
DELETE /api/v1/mem/memory/{id}        # åˆ é™¤
POST   /api/v1/mem/chat               # å¯¹è¯ï¼ˆSSE æµå¼ï¼‰
GET    /api/v1/mem/style              # é£æ ¼åˆ†æ
POST   /api/v1/mem/learn              # æ‰¹é‡å­¦ä¹ 
```

---

## 4. é‡æ„å®æ–½è·¯çº¿

### Phase 1: åŸºç¡€é‡æ„ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**: å»ºç«‹æ¸…æ™°çš„æ¶æ„å’Œæ•°æ®æ¨¡å‹

âœ… ä»»åŠ¡:
1. å®šä¹‰ç»Ÿä¸€çš„ `Document` æ¨¡å‹ï¼ˆdomain.pyï¼‰
2. å®ç° `BaseRepository` å’Œå…·ä½“å®ç°ç±»
3. å¼•å…¥å…ƒæ•°æ®æ•°æ®åº“ï¼ˆSQLiteï¼‰
4. é‡æ„ `RAGService` å’Œ `MEMService`ï¼ŒèŒè´£æ˜ç¡®
5. ç»Ÿä¸€ API å“åº”æ ¼å¼

ğŸ“ å½±å“æ–‡ä»¶:
- `backend/app/models/domain.py` (æ–°å»º)
- `backend/app/repositories/` (æ–°å»ºç›®å½•)
- `backend/app/services/rag_service.py` (é‡å†™)
- `backend/app/services/mem_service.py` (é‡å†™)

### Phase 2: åŠŸèƒ½å®Œå–„ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**: å®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„å®Œæ•´å®ç°

âœ… ä»»åŠ¡:
1. å®ŒæˆçŸ¥è¯†åº“ CRUD å®Œæ•´åŠŸèƒ½
2. å®Œæˆè®°å¿†ç®¡ç† CRUD å®Œæ•´åŠŸèƒ½
3. å®ç°åˆ†é¡µã€è¿‡æ»¤ã€æ’åº
4. å®ç°æ™ºèƒ½é—®ç­”åŠŸèƒ½ï¼ˆRAG QAï¼‰
5. å®ç°é£æ ¼åˆ†æåŠŸèƒ½

ğŸ“ æ–°å¢åŠŸèƒ½:
- `ame/rag/qa_generator.py` (é—®ç­”ç”Ÿæˆå™¨)
- `ame/mem/style_analyzer.py` (é£æ ¼åˆ†æå™¨)
- å®Œæ•´çš„ API æµ‹è¯•å¥—ä»¶

### Phase 3: å‰ç«¯ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**: å®Œå–„å‰ç«¯é¡µé¢å’Œç”¨æˆ·ä½“éªŒ

âœ… ä»»åŠ¡:
1. é‡æ„ `KnowledgePage` (å®Œæ•´å®ç°)
2. é‡æ„ `MemoryPage` (å®Œæ•´å®ç°)
3. ä¼˜åŒ– `ChatPage` (æ·»åŠ å¼•ç”¨æ¥æºå±•ç¤º)
4. ç»Ÿä¸€ç»„ä»¶åº“ï¼ˆDocumentList, MemoryTimelineç­‰ï¼‰
5. æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

### Phase 4: ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å‘¨ï¼‰

âœ… ä»»åŠ¡:
1. æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€æ‰¹é‡æ“ä½œï¼‰
2. ç¼–å†™å•å…ƒæµ‹è¯•
3. ç¼–å†™é›†æˆæµ‹è¯•
4. æ–‡æ¡£å®Œå–„

---

## 5. å…³é”®æŠ€æœ¯å†³ç­–

### 5.1 ä¸ºä»€ä¹ˆå¼•å…¥ Repository å±‚ï¼Ÿ

**é—®é¢˜**: å½“å‰ Service ç›´æ¥è°ƒç”¨ AME Engineï¼Œç¼ºå°‘æ•°æ®è®¿é—®æŠ½è±¡

**å¥½å¤„**:
- âœ… è§£è€¦ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®
- âœ… ä¾¿äºåˆ‡æ¢å­˜å‚¨å®ç°ï¼ˆVectorDBã€SQLã€NoSQLï¼‰
- âœ… ç»Ÿä¸€çš„ CRUD æ¥å£
- âœ… ä¾¿äºæµ‹è¯•ï¼ˆå¯ Mock Repositoryï¼‰

### 5.2 ä¸ºä»€ä¹ˆéœ€è¦å…ƒæ•°æ®æ•°æ®åº“ï¼Ÿ

**é—®é¢˜**: å‘é‡æ•°æ®åº“ä¸é€‚åˆå­˜å‚¨ç»“æ„åŒ–å…ƒæ•°æ®å’Œå…³ç³»

**æ–¹æ¡ˆ**: ä½¿ç”¨ SQLite å­˜å‚¨å…ƒæ•°æ®
```sql
-- documents è¡¨
CREATE TABLE documents (
    id TEXT PRIMARY KEY,
    doc_type TEXT NOT NULL,
    source TEXT,
    timestamp DATETIME,
    status TEXT,
    created_at DATETIME,
    updated_at DATETIME,
    metadata JSON
);

-- ç´¢å¼•
CREATE INDEX idx_doc_type ON documents(doc_type);
CREATE INDEX idx_source ON documents(source);
CREATE INDEX idx_timestamp ON documents(timestamp);
```

### 5.3 æ•°æ®éš”ç¦»ç­–ç•¥

```
RAG æ•°æ®:
  - å‘é‡åº“: data/rag_vector_store/
  - å…ƒæ•°æ®: metadata.db (doc_type = 'rag_knowledge')
  - æ–‡ä»¶: data/uploads/rag/

MEM æ•°æ®:
  - å‘é‡åº“: data/mem_vector_store/
  - å…ƒæ•°æ®: metadata.db (doc_type = 'mem_*')
  - æ–‡ä»¶: data/uploads/mem/
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 å‘½åè§„èŒƒ

```python
# å‡½æ•°å‘½åï¼ˆåŠ¨è¯å¼€å¤´ï¼‰
create_knowledge()   # åˆ›å»º
get_knowledge()      # è·å–å•ä¸ª
list_knowledge()     # è·å–åˆ—è¡¨
update_knowledge()   # æ›´æ–°
delete_knowledge()   # åˆ é™¤
search_knowledge()   # æ£€ç´¢

# ç±»å‘½åï¼ˆåè¯ï¼‰
RAGService           # æœåŠ¡
RAGRepository        # ä»“åº“
Knowledge            # æ¨¡å‹

# æ–‡ä»¶å‘½åï¼ˆè›‡å½¢å‘½åï¼‰
rag_service.py
rag_repository.py
```

### 6.2 é”™è¯¯å¤„ç†

```python
# è‡ªå®šä¹‰å¼‚å¸¸
class AppException(Exception):
    def __init__(self, code: str, message: str, details: Any = None):
        self.code = code
        self.message = message
        self.details = details

class DocumentNotFoundError(AppException):
    def __init__(self, doc_id: str):
        super().__init__(
            code="DOCUMENT_NOT_FOUND",
            message=f"Document {doc_id} not found",
            details={"doc_id": doc_id}
        )

# ç»Ÿä¸€å¼‚å¸¸å¤„ç†
@app.exception_handler(AppException)
async def app_exception_handler(request, exc):
    return JSONResponse(
        status_code=400,
        content={
            "success": False,
            "error": {
                "code": exc.code,
                "message": exc.message,
                "details": exc.details
            },
            "timestamp": datetime.now().isoformat()
        }
    )
```

### 6.3 æ—¥å¿—è§„èŒƒ

```python
# ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—
logger.info("Knowledge created", extra={
    "knowledge_id": knowledge.id,
    "source": knowledge.source,
    "chunks": total_chunks
})

logger.error("Failed to create knowledge", extra={
    "error": str(e),
    "file": file.filename
}, exc_info=True)
```

---

## 7. é™„å½•

### 7.1 ç›®å½•ç»“æ„å¯¹æ¯”

**å½“å‰ç»“æ„** â†’ **é‡æ„åç»“æ„**

```
backend/app/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ rag_service.py        (è–„åŒ…è£…)
â”‚   â””â”€â”€ mem_service.py        (è–„åŒ…è£…)

â†“ é‡æ„ä¸º â†“

backend/app/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ domain.py             â­ æ–°å¢ï¼ˆé¢†åŸŸæ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ requests.py
â”‚   â””â”€â”€ responses.py
â”œâ”€â”€ repositories/             â­ æ–°å¢ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ rag_repository.py
â”‚   â””â”€â”€ mem_repository.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ rag_service.py        (ä¸šåŠ¡é€»è¾‘)
â”‚   â””â”€â”€ mem_service.py        (ä¸šåŠ¡é€»è¾‘)
```

### 7.2 æŠ€æœ¯é€‰å‹ç†ç”±

| ç»„ä»¶ | å½“å‰ | å»ºè®® | ç†ç”± |
|-----|------|------|------|
| å‘é‡æ•°æ®åº“ | Memu/ChromaDB | ä¿æŒ | æ»¡è¶³éœ€æ±‚ |
| å…ƒæ•°æ®å­˜å‚¨ | æ—  | SQLite | è½»é‡ã€åµŒå…¥å¼ã€æ”¯æŒ SQL |
| ORM | æ—  | SQLAlchemy (å¯é€‰) | å¦‚éœ€å¤æ‚æŸ¥è¯¢å¯å¼•å…¥ |
| æµ‹è¯•æ¡†æ¶ | æ—  | pytest + pytest-asyncio | Python æ ‡å‡† |
| API æ–‡æ¡£ | FastAPI è‡ªåŠ¨ç”Ÿæˆ | ä¿æŒ | å·²è¶³å¤Ÿ |

### 7.3 è¿ç§»è®¡åˆ’

**æ•°æ®è¿ç§»**: ç°æœ‰å‘é‡æ•°æ® â†’ æ–°ç»“æ„

```python
# è¿ç§»è„šæœ¬ç¤ºä¾‹
async def migrate_existing_data():
    """è¿ç§»ç°æœ‰å‘é‡æ•°æ®åˆ°æ–°ç»“æ„"""
    # 1. ä»æ—§å‘é‡åº“è¯»å–
    old_data = await old_vector_store.get_all()
    
    # 2. è½¬æ¢ä¸ºæ–°æ¨¡å‹
    for item in old_data:
        doc = Document(
            content=item["content"],
            doc_type=DocumentType.RAG_KNOWLEDGE,
            source=item["metadata"].get("source"),
            timestamp=parse_timestamp(item["metadata"].get("timestamp")),
            metadata=item["metadata"]
        )
        
        # 3. ä¿å­˜åˆ°æ–°ä»“åº“
        await new_repository.create(doc)
```

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒæ”¹è¿›

1. **æ¸…æ™°çš„æ¦‚å¿µå®šä¹‰**: RAG å’Œ MEM èŒè´£æ˜ç¡®
2. **åˆ†å±‚æ¶æ„**: API â†’ Service â†’ Engine â†’ Repository â†’ Storage
3. **ç»Ÿä¸€æ•°æ®æ¨¡å‹**: Document åŸºç±» + Knowledge/Memory å­ç±»
4. **å®Œæ•´çš„ CRUD**: ä¸å†æœ‰åŠæˆå“åŠŸèƒ½
5. **å¯æµ‹è¯•æ€§**: Repository æ¨¡å¼ä¾¿äº Mock å’Œå•å…ƒæµ‹è¯•

### 8.2 é¢„æœŸæ”¶ç›Š

- ğŸ“ˆ **å¯ç»´æŠ¤æ€§**: èŒè´£æ¸…æ™°ï¼Œæ¨¡å—è§£è€¦
- ğŸš€ **å¯æ‰©å±•æ€§**: æ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰ä»£ç 
- ğŸ§ª **å¯æµ‹è¯•æ€§**: æ¯å±‚å¯ç‹¬ç«‹æµ‹è¯•
- ğŸ“š **å¯è¯»æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œå‘½åè§„èŒƒ

### 8.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **Review æœ¬æ–‡æ¡£**: ä¸å›¢é˜Ÿè®¨è®ºè®¾è®¡æ–¹æ¡ˆ
2. **åˆ›å»º Issue**: æŒ‰ Phase æ‹†åˆ†ä»»åŠ¡
3. **å»ºç«‹åˆ†æ”¯**: åˆ›å»º `refactor/v2.0` åˆ†æ”¯
4. **å¼€å§‹ Phase 1**: å…ˆå»ºç«‹åŸºç¡€æ¶æ„
5. **è¿­ä»£å¼€å‘**: æ¯ä¸ª Phase å®Œæˆå Review

---

**Document Version**: 2.0.0  
**Last Updated**: 2025-11-07  
**Status**: Draft - Awaiting Review
